# Repo notes: atom/atom

## Overview
- README checks the basic boxes but lacks any path into the code base
  - test shields
  - mentions and links to Electron
  - product description, including links to community and code of conduct
  - links to documentation: Flight Manual and API Reference (see my notes)
  - installation prerequisites and OS steps
  - links to building instructions
  - license
- how to know the code?
  - existing docs don't directly answer that question
- goals of this doc:
  - break down and understand the codebase from a wide view
  - trace a beginning path through the code to gain that understanding

## Basic Branching
- `apm` for Atom Package Manager
  - just an install folder for APM: https://github.com/atom/apm
  - most use cases covered by APM command line tool
  - API info: https://atom.io/docs/api/v1.29.0/PackageManager
  - Flight Manual: https://flight-manual.atom.io/atom-server-side-apis/sections/atom-package-server-api/
  - an [example of how Atom uses apm](https://github.com/atom/settings-view/blob/master/lib/package-manager.coffee)
- `benchmark` for a benchmark runner and large file / long line tests
- `docs` for building documentation
  - focused on platform-specific instructions for building Atom from source
  - this was moved to the Flight Manual
  - `./focus` contains a doc [sharing current plans](https://github.com/atom/atom/tree/master/docs/focus)
- `dot-atom` contains the files and directories that install to `.atom`
  - including the custom stylesheet and keymap files
  - including the custom packages directory
- `exports` requires and exports objects
  - requires and exports a bunch of src objects that all seem to deal with file and buffer load/events
    - including Task and TextEditor when not a child node process (meaning when process type is `'renderer'`)
  - also contains a handful of Electron API shims using [grim.deprecate](https://github.com/atom/grim/blob/master/src/grim.coffee)
- `keymaps`
  - cson keybinding maps for various platforms
  - `base.cson` has selectors for `atom-text-editor` and many `body` default to native
  - movement, selection and many other bindings for `darwin`, `linux`, `win32`
- `menus`
  - three files containing array of menu items for different platforms
  - objects contain a `label` and `submenu` arrays of objects with `label` and `command`
- `resources`
  - png app icons
  - shell script, js and apm shell and command scripts for `win` installation
  - long bundle info plist for `mac`
  - debian and redhat package for `linux`
- `script`
  - a variety of scripts for building Atom
  - linter scripts
  - version and platform sensitive installation, cleaning, transpiling
  - `vsts` subfolder
    - contains its own README
    - scripts for automating Atom releases
    - `yml` files for configuring releases
    - tasks for handling release branch on different platforms
    - uses Visual Studio Team Services
      - [multi-phase jobs](https://github.com/Microsoft/vsts-agent/blob/master/docs/preview/yamlgettingstarted-jobs.md)
      - generate Atom installation packages on all three platforms
      - publish new release on successful build
    - Atom Nightly packages published to GitHub and atom.io
    - version release numbers calculated by `generate-version.js`
      - nightly release number incremented after comparing base version against `package.json`
    - phase templates build Atom simultaneously across platforms
    - successful build release artifacts uploaded to S3 bucket
- `spec`
  - quite a large directory with many CoffeeScript and JS `-spec` files
  - Jasmine `describe` tests
    - run for Atom environment, paths, clipboard, installation, grammar registry, style manager and much more
    - the project settings `config` spec is a long, representative example: https://github.com/atom/atom/blob/master/spec/config-spec.js
  - `./helpers` directory contains a random line builder and a very long lexicon
  - `./fixtures` contains samples with extreme formatting, example packages, sample themes
  - `./main-process` contains the application test and command line test
- `src`
  - `./main-process` subdirectory contains application start, menu, win updater and more
    - the short `main.js` is where the start path is built
    - `parse-command-line.js` breaks down cli args and returns object with all the process info
    - `start.js` is called from `main`
      - runs the command line parser and stores the resulting `args`
      - sets up `app.on` events for opening files, launching and ready
      - requires `./main-process/atom-application` and runs `.open` with `args`
      - defines a `getConfig` function to read the config file
  - the rest of the directory is many `.js` and `.coffee` files
    - class exports for many of the objects documented in the API
      - for example, [Package](https://atom.io/docs/api/v1.29.0/Package) relates to `package.js`
      - that example defines `onDidDeactivate (callback) { ... }` mentioned in the API docs
      - others include everything from `gutter` to `pane` to `cursor` to global `config-file`
    - `grammar-registry` is an example with many requires, complex class methods, much to think through
    - some API doc classes come from other sources imported into these `src` files
      - like `Emitter` from `event-kit`
        - for example, the `package.js` mentioned above requires and instantiates `Emitter`, then `onDidDeactivate` returns `emitter.on()` event with your callback
      - or like `Disposable` and `CompositeDisposable` from `event-kit`
    - some scripts provide other functionality
      - like how `crash-reporter-start` requires and starts CrashReporter from `electron`
      - or how `babel` creates a babel version and compiles source using babel
- `static`
  - `.less` files for editor, cursors, docks, syntax and much more
  - stylesheet fallback variables
  - basic html template `index.html`
  - window load and setup script in `index.js`
  - and the octocat spinner!
- `vendor`
  - Jasmine tests for JS and JQuery
  - on second glance, these are not tests but the testing framework
  - see tests under `spec`
- root files
  - `.gitattributes` for defining line endings on `spec/fixtures` files
  - support/appinfo files for appveyer, coffeelinter, Python versioning, style linter, Docker
  - package and package locks for node
  - Travis config yaml file
  - `LICENSE` copyrights software to GitHub, permissively allowing as-is use
  - user submission templates
    - `ISSUE_TEMPLATE` defines checklist and format to use when submitting an issue
    - `PULL_REQUEST_TEMPLATE` defines requirements and needed info when submitting a PR
  - `CHANGELOG` links to [Atom releases](https://atom.io/releases)
  - `README` and `SUPPORT` provide documentation for getting into Atom
    - the readme focuses on installation
    - the support doc focuses on links into the documentation and community
  - `CODE_OF_CONDUCT` adapts the OSS [Contributor Covenant](https://www.contributor-covenant.org/)
  - `CONTRIBUTING` offers a detailed set of guidelines for contributing to Atom

## CONTRIBUTING.md in greater detail
- since the focus of my repo is on contributing, I'll outline this in detail
- Atom as part of the [Atom Organization](https://github.com/atom)
- contributor covenant as mentioned above
- issues are a [deluge](https://blog.atom.io/2016/04/19/managing-the-deluge-of-atom-issues.html) and are not for questions
- discussions happen at [discuss](https://discuss.atom.io/), which has a FAQ[FAQ](https://discuss.atom.io/c/faq)
- faster discussion happens in the [team chat](https://atom-slack.herokuapp.com/)
  - use the appropriate channel: `#atom`, `#electron`, `#packages`, `ui`
- background knowledge
  - Atom has over 200 repos, so know which implements which functionality
  - this helps so you know where to report bugs
  - modularity by intention
    - non-editor UI is almost always a separate package
    - even tree-view, find-and-replace, tabs and status-bar are packages
    - key difference: whether a package is bundled into default distribution
  - visit `Settings` and view `Packages` to see Core packages
    - Atom Core: `atom/atom`
      - text editor
      - associated functionality like indentation, wrapping, rendering, file system, installation and updating
      - this repo is good for giving feedback on API or proposing "overarching" features
    - stuff around the UI
      - like `tree-view`, `fuzzy-finder` (quick file opener), `find-and-replace`, `tabs`, `markdown-preview`, `settings-view`, ...
    - stuff around behavior and styling
      - like autocomplete, git, default UI and syntax themes
    - Atom Package Manager: `apm`
    - Feedback repo for website and `apm`'s package API: `atom.io`
  - note that issues arise from [community pacakges and themes](https://discuss.atom.io/t/i-have-a-question-about-a-specific-atom-community-package-where-is-the-best-place-to-ask-it/25581)
  - package naming conventions
    - syntax highlighting grammars: `language-[language-name]`
      - these can add more than grammars but shouldn't get too bulky
    - UI themes: `[theme-name]-ui`
      - these style stuff outside editor pane
    - syntax themes: `[theme-name]-syntax`
      - these style stuff inside editor pane
      - (me: wow, that's an easy distinction I wish the Flight Manual made)
    - coordinate themes that do both, like `one-dark-ui` and `one-dark-syntax`
    - atocomplete providers: `autocomplete-[autocompleted]`
      - an example might be `autocomplete-css`
  - design decisions
    - commitment to maintain a [decisions repo](https://github.com/atom/design-decisions)
    - this will include big decisions about how Atom is maintained and what can be supported
    - if decisions are not documented there, check the "discuss" link above
- ways to contribute
  - report a bug
    - point of having you follow these steps
      - maintainers and community can understand your report
      - maintainers and community can reproduce the behavior
      - maintainers and community can find related reports
    - general things to keep in mind as you report
      - [ ] be as detailed as you can
      - [ ] if there's a similar closed issue, include a link
      - [ ] stick to the [issue template](https://github.com/atom/atom/blob/master/ISSUE_TEMPLATE.md)
    - follow these steps _before_ submitting a report:
      - [ ] check if you can reproduce the problem in the latest Atom release
      - [ ] check if the problem shows up in safe mode
      - [ ] check if you can solve by changing package config
      - [ ] reread the [debugging guide](https://flight-manual.atom.io/hacking-atom/sections/debugging/) to see if you can fix it yourself
      - [ ] check the [FAQ](https://discuss.atom.io/c/faq)
      - [ ] figure out which repo this issue belongs in
      - [ ] search already [reported issues](https://github.com/search?q=+is%3Aissue+user%3Aatom) to see if you can just add a comment to an existing issue
    - follow these steps _when_ submitting a report:
      - [ ] understand that bugs are tracked as [GitHub issues](https://guides.github.com/features/issues/)
      - [ ] determine the correct Atom repo (mentioned above)
      - [ ] create an issue
      - [ ] fill out the template (linked above)
      - [ ] explain the problem with:
        - [ ] clear, descriptive title
        - [ ] exact steps to reproduce the issue (not _what_ you did but _how_: with a mouse or a shortcut? which one?)
        - [ ] specific examples for each step (links to files/projects, Markdown code block snippets)
        - [ ] observed behavior after these steps are taken
        - [ ] expected behavior and why it's expected
        - [ ] screenshots or [animated GIFs](https://www.cockos.com/licecap/) with Keybinding Resolver in view
        - [ ] crash reports with stack trace from the OS if issue crashes Atom
          - Mac `Console.app` under "User Diagnostic Reports"
          - include in a code block, attached file or link to gist
        - [ ] a [CPU profile caputure](https://flight-manual.atom.io/hacking-atom/sections/debugging/#diagnose-runtime-performance) for memory or performance issues
        - [ ] confirmation you ran in safe mode and used a different theme (or commented out styles) if Chrome dev tools show without being triggered
        - [ ] your prior actions if the problem wasn't triggered by specific actions
      - [ ] answer these questions to give more context:
        - [ ] Can the problem be reproduced in safe mode?
          - [ ] If so, can you reproduce it in an older Atom version?
        - [ ] Did the problem start recently?
        - [ ] Can you reproduce the problem reliably?
        - [ ] Does the problem happen for all files/projects or only some?
          - [ ] check if it's only for specific file types
          - [ ] check if it's only large files or files with long lines
          - [ ] check if it's only remote or local files
      - [ ] include config and environment info
        - [ ] your Atom version (`atom -v` or `Application: About` in the Command Palette)
        - [ ] your OS name and version
        - [ ] your VM if applicable (software and OS name/version for host and guest)
        - [ ] your Atom packages (`apm list --installed`)
        - [ ] your customized local config files (`config.cson`, `keymap.cson`, `snippets.cson`, `styles.less`)
          - ideally in a code block or a gist link
        - [ ] your monitor setup if using multiple monitors (have you tried only one?)
        - [ ] your keyboard layout (US, ...)
  - suggest enhancements
    - submit an "enhancement suggestion" for:
      - features for new functionality
      - minor improvements
    - follow these guidelines so
      - maintainers and community can understand your suggestion
      - maintainers and community can find related suggestions
    - general advice when considering creating one
      - check the pre-submitting steps below
      - include as many details as you can
      - refer to and use the [issue template](https://github.com/atom/atom/blob/master/ISSUE_TEMPLATE.md)
    - before submitting
      - [ ] review the [debugging guide](https://flight-manual.atom.io/hacking-atom/sections/debugging/) to make sure the enhancement doesn't already exist
      - [ ] make sure you're on the latest Atom version
      - [ ] check if you can get the behavior through core packages or config
      - [ ] check if you can get the behavior through registered Atom packages
      - [ ] figure out the relevant Atom repo
      - [ ] search [existing suggestions](https://github.com/search?q=+is%3Aissue+user%3Aatom) before opening a new one
    - while submitting
      - [ ] understand that enhancement suggestions are tracked through GitHub issues
      - [ ] create an issue on the relevant repo you determined above
      - [ ] fill out the issue with:
        - [ ] a clear title for identifying your suggestion
        - [ ] a detailed, step-by-step description
        - [ ] specific, demonstrable examples with Markdown code block snippets
        - [ ] a description of the current behavior vs what you expect instead
        - [ ] screenshots and animated GIFs to demonstrate steps and related parts of Atom
        - [ ] an explanation of the enhancement's usefulness to Atom users
          - [ ] including why this couldn't be a community package
        - [ ] a list of other text editors or apps with this enhancement
        - [ ] the version of Atom you're on (`atom -v` or Command Pallete `Application: About`)
        - [ ] the name and version of your OS
  - your first contribution
    - understand where to begin when contributing to Atom
      - search [beginner issues](https://github.com/search?utf8=%E2%9C%93&q=is%3Aopen+is%3Aissue+label%3Abeginner+label%3Ahelp-wanted+user%3Aatom+sort%3Acomments-desc)
      - search [help wanted issues](https://github.com/search?q=is%3Aopen+is%3Aissue+label%3Ahelp-wanted+user%3Aatom+sort%3Acomments-desc+-label%3Abeginner)
      - "help wanted" issues are more involved
      - issue lists are sorted by comment count (to operationalize the "impact a given change will have")
    - read through the Flight Manual for using Atom or developing packages
    - local development
      - core and packages support local development
      - the relevant Flight Manual sections are [Hacking on Atom Core](https://flight-manual.atom.io/hacking-atom/sections/hacking-on-atom-core/) and [Contributing to Official Atom Packages](https://flight-manual.atom.io/hacking-atom/sections/contributing-to-official-atom-packages/)
  - pull requests
    - refer to the [template](https://github.com/atom/atom/blob/master/PULL_REQUEST_TEMPLATE.md)
    - make sure the PR includes:
      - clear title but without the PR issue number
      - animated GIFs and screenshots
      - syntax and styling following the [JS](https://github.com/atom/atom/blob/master/CONTRIBUTING.md#javascript-styleguide) and [CS](https://github.com/atom/atom/blob/master/CONTRIBUTING.md#coffeescript-styleguide) guides
      - Jasmine specs in the `./spec` dir that have been run with `atom --test spec`
        - these tests should be "thoughtfully worded"
        - these tests should be "well structured"
      - follow the [documentation styleguide](https://github.com/atom/atom/blob/master/CONTRIBUTING.md#documentation-styleguide) for any added code
      - files that end in a newline
      - no platform dependent code
      - ordered requires: built in Node modules, built in Atom and Electron modules, local modules (with relative paths)
      - ordered class properties: class properties (`@` in CoffeeScript, `static` in JS), then instance methods/properties
- Styleguides
  - git commit messages
    - verbs in the present tense, imperative mood
    - first line length <= 72 characters
    - after first line reference specific issues and PRs
    - documentation changes: include `[ci skip]` in the title
    - begin with the [correct emoji](https://github.com/atom/atom/blob/master/CONTRIBUTING.md#git-commit-messages)
  - JS
    - stick to [Standard Style](https://standardjs.com/)
    - use object spread instead of `Object.assign()`
    - use inline exports instead of post-definition/instantiation exports
  - CS
    - default parameters without spaces around equals sign
    - spaces around operators otherwise
    - spaces after commas that aren't followed by newline
    - use parens when they make code clearer
    - use alphabetic instead of symbolic keywords: `is` over `==`
    - do not use spaces before closing curly brace or after opening curly brace
    - leave one whitespace line between method definitions
    - caps acronyms unless they are the first word: `getURI` but `uri`
    - copy arrays with `slice()`
    - use explicit `return`s in functions ending in `for`/`while` loops
      - do this when avoiding returning a collection
    - use `this` instead of standalone `@`: `return this` not `return @`
  - specs
    - use Jasmine specs in `./spec`
      - ensure they're "thoughtfully-worded, well-structured" tests
      - use `describe` statements for nouns or situations
      - use `it` statements for states or operation changes to state
    - consider [this simple example](https://github.com/atom/atom/blob/master/CONTRIBUTING.md#example)
  - documentation
    - use the [AtomDoc parser](https://github.com/atom/atomdoc)
    - use Markdown
    - reference classes and methods with this notation:
      - classes with `{ClassName}`
      - instance methods with `{ClassName::methodName}`
      - class methods with `{ClassName.methodName}`
- issue and PR labels
  - for issue types and issue states
    - enhancements: feature requests
    - bugs: reported (when likely) or confirmed bugs
      - needs-reproduction are likely bugs but need tested
    - questions and feedback from users
    - more-information-needed, needs-reproduction for more about reproduce steps
    - duplicate, blocked, invalid, wontfix, wrong-repo for issues with issues
    - help-wanted, beginner for community calls for contributors
    - package-ideas for new packages instead of extensions or core
  - for topic categories
    - os: windows, linux, mac
    - documentation, performance, security, ui
    - errors: uncaught-exception, crash
    - ui, api, git, network (remote files), encoding
  - atom/atom topic categories
    - editor text rendering (independent of language)
    - errors: from pathwatcher, from save, from open, build errrors
    - os: installer, auto-updater
    - deprecation help for packages removing deprecated API usage
  - PR labels
    - work in progress
    - needs review or under review
    - requires changes
    - needs testing

## src directory in greater detail
- flow:
  - `package.json` has a key `"main"` pointing to `src/main-process/main.js`
  - `package.json` has a `"standard"` key for `"snapshotResult"`
  - `src/main-process/main.js` checks for any `snapshotResult`
  - `main.js` builds a path to and calls `start.js`
  - `start.js` opens `atom-application.js`:
    - imports the electron app
    - imports a path
    - defines a `start` function that:
      - adds exception and rejection handling listeners
      - parses the command line args
      - adds app open listeners for path and url
      - sets app path to user or test data
      - adds app ready listener to remove open listeners then open Atom app
        - path built from resource path + `src/main-process/atom-application.js`
    - (outside `start` are also win32 and user config file functions)
  - `atom-application` loads and juggles the app
    - imports `atom-window`, `application-menu`, `config-file`, other Atom stuff
    - imports `event-kit` disposables
    - imports electron pieces like `BrowserWindow`, `clipboard`, `screen`
    - beyond that the Atom app's class is defined including the open method (run from `start`)
    - see closer look at `atom-application.js` below
  - `atom-window` is included in the Atom application
    - see closer look at `application-menu.js` below
  - `application-menu` is included in the Atom application
    - see closer look at `atom-window.js` below

TODO learn more about:
- socket files
- Electron including `app`

### atom-application.js
- requires `AtomWindow`, `ApplicationMenu`, `event-kit` Disposables, `EventEmitter`, ...
- requires multiple `electron` exports including `app`
- crucially exports a defined `AtomApplication` class inheriting from `EventEmitter`
  - comment notes it's a singleton entry point to the app
  - comment notes it holds global app state
  - starts by defining a static method `open`
    - if there's not an open socket file, create a socket path
    - instantiate and initialize `AtomApplication`
    - set up `net.connect` client to end connection and run `app.quit`
    - have client reinstantiate and reinitialize on `'error'`
  - then defines an `exit` method
    - this runs `app.exit`
  - next comes the constructor method

## application-menu.js
-

## atom-window.js
-
